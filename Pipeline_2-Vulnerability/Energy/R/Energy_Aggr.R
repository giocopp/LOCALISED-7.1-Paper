setwd("/Users/giocopp/Desktop/LOCALISED-7.1-Paper/Pipeline_2-Vulnerability/Energy")

# Read data
regional_energy_c <- readxl::read_xlsx("Outputs/Data/Energy_FEC_Data.xlsx")
View(regional_energy_c)

# Summarize the total energy index per region & sector
regional_energy_sums <- regional_energy_c %>%
  group_by(NUTS_ID, Sector_ID) %>%
  mutate(
    Energy_Index = sum(Regional_Energy_Norm, na.rm = TRUE)
  ) %>%
  ungroup() %>% 
  select(Country, NUTS_ID, Sector_ID, Sector_Name, Energy_Index) %>% 
  distinct(NUTS_ID, Sector_ID, .keep_all = TRUE)

min(regional_energy_sums$Energy_Index)
max(regional_energy_sums$Energy_Index)

regional_energy_sums

# Define the normalization function
regional_energy_sums <- regional_energy_sums %>%
  mutate(Sector_Group = if_else(Sector_ID == "C", "C", "Other")) %>%
  group_by(Sector_Group) %>%
  mutate(Energy_Index_norm = (Energy_Index - min(Energy_Index)) / (max(Energy_Index) - min(Energy_Index))) %>%
  ungroup() %>%
  select(-Sector_Group)

# Save the updated dataset
writexl::write_xlsx(
  regional_energy_sums,
  "Outputs/Data/Energy_Index.xlsx")

return("Outputs/Data/Energy_Index.xlsx")
